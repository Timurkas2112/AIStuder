{% extends "main.html" %}

{% block content %}
<style>
    .form label {
        font-size: 16px;
        margin-bottom: 6px;
        display: block;
        color: #333;
    }

    .form input[type="text"],
    .form textarea {
        height: 60px;
        width: 100%;
        padding: 0 15px;
        font-size: 17px;
        margin-bottom: 1.3rem;
        border: 1px solid #ddd;
        border-radius: 6px;
        outline: none;
        background-color: #fff;
        font-family: 'Poppins', sans-serif;
    }

    .form textarea {
        height: 120px;
        resize: vertical;
    }

    .form input.button {
        color: #fff;
        background: linear-gradient(135deg, #009579, #007965);
        font-size: 1.2rem;
        font-weight: 600;
        letter-spacing: 0.5px;
        margin-top: 1.5rem;
        cursor: pointer;
        transition: background 0.3s, transform 0.2s, box-shadow 0.3s;
        border: none;
        border-radius: 8px;
        height: 60px;
        width: 100%;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
    }

    .form input.button:hover {
        background: linear-gradient(135deg, #007965, #005f4a);
        box-shadow: 0 6px 14px rgba(0, 0, 0, 0.25);
    }

    .form input.button:active {
        transform: scale(0.98);
        box-shadow: 0 3px 6px rgba(0, 0, 0, 0.2);
    }

    .manual-button {
        display: inline-block;
        background: #fff;
        color: #009579;
        padding: 12px 25px;
        font-size: 1rem;
        font-weight: 600;
        border: 2px solid #009579;
        border-radius: 8px;
        text-decoration: none;
        transition: all 0.3s ease;
        margin-top: 10px;
    }

    .manual-button:hover {
        background-color: #009579;
        color: #fff;
    }

    #addChapterButton {
        display: inline-block;
        background-color: #007965;
        color: white;
        padding: 12px 25px;
        font-size: 1rem;
        font-weight: 600;
        border-radius: 8px;
        border: none;
        cursor: pointer;
        transition: background 0.3s, transform 0.2s, box-shadow 0.3s;
        margin-top: 15px;
    }

    #addChapterButton:hover {
        background-color: #005f4a;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
    }

    #addChapterButton:active {
        transform: scale(0.98);
        box-shadow: 0 3px 6px rgba(0, 0, 0, 0.2);
    }

    .form .addChapter {
        margin-bottom: 2rem;
        position: relative;
        padding: 1rem;
        border: 1px solid #ddd;
        border-radius: 8px;
        background-color: #f9f9f9;
    }

    .remove-chapter-btn {
    background-color: #e74c3c;
    color: white;
    border: none;
    border-radius: 6px;
    padding: 6px 12px;
    cursor: pointer;
    font-size: 0.9rem;
    margin-bottom: 10px;
    float: right;
}

.remove-chapter-btn:hover {
    background-color: #c0392b;
}


    #groupSelect {
    width: 100%;
    padding: 10px;
    margin-bottom: 15px;
    border: 1px solid #ddd;
    border-radius: 4px;
    background-color: #fff;
    font-size: 16px;
  }

  /* –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Ñ–æ—Ä–º—ã */
  h3 {
    margin-bottom: 20px;
    font-size: 24px;
    color: #333;
  }


/* –ö–Ω–æ–ø–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤–æ–ø—Ä–æ—Å–∞ */
.add-option-btn {
    display: inline-block;
    background-color: #009579;
    color: white;
    padding: 10px 20px;
    font-size: 0.95rem;
    font-weight: 600;
    border-radius: 6px;
    border: none;
    cursor: pointer;
    transition: background 0.3s, transform 0.2s, box-shadow 0.3s;
    margin-top: 10px;
}

.add-option-btn:hover {
    background-color: #007965;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
}

.add-option-btn:active {
    transform: scale(0.98);
    box-shadow: 0 3px 6px rgba(0, 0, 0, 0.2);
}


/* –ö–Ω–æ–ø–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤–æ–ø—Ä–æ—Å–∞ */
.add-quiz-btn {
    display: inline-block;
    background-color: #009579;
    color: white;
    padding: 10px 20px;
    font-size: 0.95rem;
    font-weight: 600;
    border-radius: 6px;
    border: none;
    cursor: pointer;
    transition: background 0.3s, transform 0.2s, box-shadow 0.3s;
    margin-top: 10px;
}

.add-quiz-btn:hover {
    background-color: #007965;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
}

.add-quiz-btn:active {
    transform: scale(0.98);
    box-shadow: 0 3px 6px rgba(0, 0, 0, 0.2);
}
/* –ö–Ω–æ–ø–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –≤–æ–ø—Ä–æ—Å–∞ */
.remove-question-btn {
    background-color: #e74c3c;
    color: white;
    border: none;
    border-radius: 6px;
    padding: 6px 12px;
    cursor: pointer;
    font-size: 0.9rem;
    margin-bottom: 10px;
    float: right;
}

.remove-question-btn:hover {
    background-color: #c0392b;
}
.quiz-option {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 10px;
}

.quiz-option input[type="text"] {
    flex-grow: 1;
}

.correct-answer-radio {
    display: flex;
    align-items: center;
    gap: 5px;
    font-size: 0.95rem;
    color: #333;
    cursor: pointer;
}

.correct-answer-radio input[type="radio"] {
    accent-color: #009579; /* –¶–≤–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–π —Ç–æ—á–∫–∏ (—Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–µ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –±—Ä–∞—É–∑–µ—Ä–æ–≤) */
    width: 18px;
    height: 18px;
    cursor: pointer;
}


.remove-option-btn {
    background-color: #e74c3c;
    color: white;
    border: none;
    border-radius: 6px;
    padding: 6px 10px;
    cursor: pointer;
    font-size: 0.9rem;
    transition: background-color 0.3s ease;
}

.remove-option-btn:hover {
    background-color: #c0392b;
}


</style>

<div class="content">
    <form class="form" action="{{ url_for('create_manual') }}" method="POST">
        <h3>–°–æ–∑–¥–∞–Ω–∏–µ –∫—É—Ä—Å–∞ –≤—Ä—É—á–Ω—É—é</h3>
        
        <!-- –í—ã–±–æ—Ä –≥—Ä—É–ø–ø—ã -->
        <label for="groupSelect">–í—ã–±–µ—Ä–∏—Ç–µ –≥—Ä—É–ø–ø—É:</label>
        <select id="groupSelect" name="group_id" required>
            <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ –≥—Ä—É–ø–ø—É --</option>
            {% for group in groups %}
                <option value="{{ group.group_id }}" 
                    {% if group.group_id == selected_group_id %}selected{% endif %}>
                    {{ group.name }}
                </option>
            {% endfor %}
        </select>

        <!-- –ù–∞–∑–≤–∞–Ω–∏–µ –∫—É—Ä—Å–∞ -->
        <label for="courseTitle">–ù–∞–∑–≤–∞–Ω–∏–µ –∫—É—Ä—Å–∞:</label>
        <input type="text" id="courseTitle" name="courseTitle" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫—É—Ä—Å–∞" required>

        <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –≥–ª–∞–≤ -->
        <div id="chaptersContainer"></div>

        <!-- –ö–Ω–æ–ø–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≥–ª–∞–≤—ã -->
        <button type="button" id="addChapterButton">–î–æ–±–∞–≤–∏—Ç—å –≥–ª–∞–≤—É</button>


        <!-- –ö–Ω–æ–ø–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã -->
        <input type="submit" class="button" value="–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫—É—Ä—Å">
    </form>

    <div style="text-align: center; margin-top: 20px;">
        <p>–ò–ª–∏</p>
        <a href="{{ url_for('create_course') }}" class="manual-button">–ù–∞–∑–∞–¥ –∫ —Å–æ–∑–¥–∞–Ω–∏—é –∫—É—Ä—Å–∞</a>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const chaptersContainer = document.getElementById('chaptersContainer');
    const addChapterBtn = document.getElementById('addChapterButton');

    // –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –≥–ª–∞–≤—ã
    function createChapter(index) {
        const chapter = document.createElement('div');
        chapter.classList.add('addChapter');
        chapter.innerHTML = `
            <button type="button" class="remove-chapter-btn">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å –≥–ª–∞–≤—É</button>
            <label>–ù–∞–∑–≤–∞–Ω–∏–µ –≥–ª–∞–≤—ã ${index}:</label>
            <input type="text" name="chapterTitle${index}" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –≥–ª–∞–≤—ã" required>
            <label>–¢–µ–∫—Å—Ç –≥–ª–∞–≤—ã ${index}:</label>
            <textarea name="chapterContent${index}" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –≥–ª–∞–≤—ã" required></textarea>
            <div class="quizzes-container" data-chapter="${index}"></div>
            <button type="button" class="add-quiz-btn">‚ûï –î–æ–±–∞–≤–∏—Ç—å –≤–æ–ø—Ä–æ—Å</button>
        `;

        chapter.querySelector('.remove-chapter-btn').addEventListener('click', () => {
            chapter.remove();
            updateChapterNumbers();
        });

        chapter.querySelector('.add-quiz-btn').addEventListener('click', () => {
            createNewQuestion(chapter, index);
        });

        return chapter;
    }

    // –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –≤–æ–ø—Ä–æ—Å–∞ (—É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–µ)
    function createNewQuestion(chapter, chapterIndex) {
        const quizzesContainer = chapter.querySelector('.quizzes-container');
        const questionCount = quizzesContainer.querySelectorAll('.quiz-item').length + 1;

        const questionHTML = `
            <div class="quiz-item" style="border: 1px solid #ccc; padding: 10px; margin: 10px 0;">
                <button type="button" class="remove-question-btn">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å –≤–æ–ø—Ä–æ—Å</button>
                <label>–í–æ–ø—Ä–æ—Å ${questionCount}:</label>
                <input type="text" name="quizQuestion${chapterIndex}_${questionCount}" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–æ–ø—Ä–æ—Å" required>
                <div class="quiz-options-container">
                    <label>–í–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ç–≤–µ—Ç–∞:</label>
                    <div class="quiz-option">
                        <input type="text" name="quizOptions${chapterIndex}_${questionCount}_1" placeholder="–í–∞—Ä–∏–∞–Ω—Ç 1" required>
                        <label class="correct-answer-radio">
                            <input type="radio" name="quizCorrect${chapterIndex}_${questionCount}" value="1" required> ‚úÖ
                        </label>
                        <button type="button" class="remove-option-btn">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>
                    </div>
                </div>
                <button type="button" class="add-option-btn">‚ûï –î–æ–±–∞–≤–∏—Ç—å –≤–∞—Ä–∏–∞–Ω—Ç</button>
                <label>–ü–æ—è—Å–Ω–µ–Ω–∏–µ:</label>
                <textarea name="quizExplanation${chapterIndex}_${questionCount}" placeholder="–ü–æ—è—Å–Ω–µ–Ω–∏–µ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)"></textarea>
            </div>
        `;

        quizzesContainer.insertAdjacentHTML('beforeend', questionHTML);
        const newQuiz = quizzesContainer.lastElementChild;
        setupQuestionEvents(newQuiz, chapterIndex);
    }

    // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –≤–æ–ø—Ä–æ—Å–∞
    function setupQuestionEvents(quizElement, chapterIndex) {
        quizElement.querySelector('.add-option-btn').addEventListener('click', function() {
    const optionsContainer = this.closest('.quiz-item').querySelector('.quiz-options-container');
    const chapterIndex = Array.from(chaptersContainer.children).indexOf(this.closest('.addChapter')) + 1;
    const questionIndex = Array.from(this.closest('.quizzes-container').querySelectorAll('.quiz-item')).indexOf(this.closest('.quiz-item')) + 1;
    const optionCount = optionsContainer.querySelectorAll('.quiz-option').length + 1;

    const newOptionHTML = `
        <div class="quiz-option">
            <input type="text" placeholder="–í–∞—Ä–∏–∞–Ω—Ç ${optionCount}" required>
            <label class="correct-answer-radio">
                <input type="radio" name="quizCorrect${chapterIndex}_${questionIndex}" value="${optionCount}"> ‚úÖ
            </label>
            <button type="button" class="remove-option-btn">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>
        </div>
    `;
    
    optionsContainer.insertAdjacentHTML('beforeend', newOptionHTML);
    
    // –í–µ—à–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —É–¥–∞–ª–µ–Ω–∏—è –Ω–∞ –ù–û–í–£–Æ –∫–Ω–æ–ø–∫—É
    optionsContainer.lastElementChild.querySelector('.remove-option-btn').addEventListener('click', function() {
        this.closest('.quiz-option').remove();
        reindexOptions(optionsContainer); // –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º –∏–Ω–¥–µ–∫—Å—ã
    });
    
    reindexOptions(optionsContainer); // –§–∏–∫—Å–∏–º –∏–º–µ–Ω–∞ –ø–æ–ª–µ–π
});
    }

    // –ü–µ—Ä–µ–∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –æ—Ç–≤–µ—Ç–∞
    function reindexOptions(optionsContainer) {
    const quizItem = optionsContainer.closest('.quiz-item');
    const chapterIndex = Array.from(chaptersContainer.children).indexOf(quizItem.closest('.addChapter')) + 1;
    const questionIndex = Array.from(quizItem.closest('.quizzes-container').querySelectorAll('.quiz-item')).indexOf(quizItem) + 1;

    optionsContainer.querySelectorAll('.quiz-option').forEach((opt, i) => {
        const newIndex = i + 1;
        opt.querySelector('input[type="text"]').name = `quizOptions${chapterIndex}_${questionIndex}_${newIndex}`;
        opt.querySelector('input[type="radio"]').name = `quizCorrect${chapterIndex}_${questionIndex}`;
        opt.querySelector('input[type="radio"]').value = newIndex;
        opt.querySelector('input[type="text"]').placeholder = `–í–∞—Ä–∏–∞–Ω—Ç ${newIndex}`;
    });
}

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–æ–º–µ—Ä–æ–≤ –≥–ª–∞–≤ –∏ –≤–æ–ø—Ä–æ—Å–æ–≤
    function updateChapterNumbers() {
        chaptersContainer.querySelectorAll('.addChapter').forEach((chapter, i) => {
            const newChapterIndex = i + 1;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–∫–∏ –≥–ª–∞–≤
            chapter.querySelector('label:nth-of-type(1)').textContent = `–ù–∞–∑–≤–∞–Ω–∏–µ –≥–ª–∞–≤—ã ${newChapterIndex}:`;
            chapter.querySelector('input[name^="chapterTitle"]').name = `chapterTitle${newChapterIndex}`;
            chapter.querySelector('label:nth-of-type(2)').textContent = `–¢–µ–∫—Å—Ç –≥–ª–∞–≤—ã ${newChapterIndex}:`;
            chapter.querySelector('textarea[name^="chapterContent"]').name = `chapterContent${newChapterIndex}`;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –≤–æ–ø—Ä–æ—Å—ã
            chapter.querySelectorAll('.quiz-item').forEach((quiz, j) => {
                const newQuestionIndex = j + 1;
                quiz.querySelector('input[name^="quizQuestion"]').name = `quizQuestion${newChapterIndex}_${newQuestionIndex}`;
                quiz.querySelector('textarea[name^="quizExplanation"]').name = `quizExplanation${newChapterIndex}_${newQuestionIndex}`;
                reindexOptions(quiz.querySelector('.quiz-options-container'));
            });
        });
    }

    // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π –≥–ª–∞–≤—ã
    addChapterBtn.addEventListener('click', () => {
        const newChapter = createChapter(chaptersContainer.children.length + 1);
        chaptersContainer.appendChild(newChapter);
    });
});
</script>

{% endblock %}
